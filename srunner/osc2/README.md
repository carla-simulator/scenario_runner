# Introduction to modules
## Brief introduction of Antlr4
Antlr4 is a powerful tool for generating grammar parsers. 
Given the grammar of a language, Antlr4 can generate a parser for that language and automatically build a parse tree. 
Additional functionality can be achieved by traversing this tree and triggering callback functions at desired structures. 
To this end, Antlr4 provides autogenerated parse tree walkers: listeners or visitors. 
In addition, Antlr4 provides error reporting and error handling functionality, 
and error messages can be customized by implementing the interfaces provided by Antlr4. 
For more information, please refer to the [Antlr website](https://www.antlr.org/).

### Build the AST
```
antlr4 -Dlanguage=Python3 Example.g4
```
After executing this command, multiple files will be generated, and it is necessary to understand the following files:
- ExampleParser.py: This file contains a syntax parser for recognizing 'Example syntax'.
- ExampleListener.py: This file contains a traverser of the syntax analysis tree in the form of a listener - the ExampleListener class. When using a listener to traverse the syntax analysis tree, the callback method of the listener will be triggered. This class defines a series of callback methods and provides default empty implementations for these methods. When using it, the user only needs to override the methods needed.
- Example.tokens: Antlr will define a corresponding number for each lexical symbol defined in the grammar file, and this file is used to store the correspondence between them.

### Traversal the AST
Antlr provides two mechanisms to access the syntax parse tree, namely listener or visitor. The biggest difference between the two is that the listener method will be automatically called during the process of accessing the sub-nodes of the syntax parse tree, while the visitor method must explicitly call the visit method to access the sub-nodes, otherwise the subtree will not be visited.

#### Listener
The ExampleListener class corresponds to the listener generated by Antlr4. When constructing their own visitor, users need to inherit this class and implement the required methods. The listener will generate an enterxxx() method and an exitxxx() method for each sub-node. When entering a node, the enterxxx() method will be called, and when all the child nodes of the node have been traversed and exited, the corresponding exitxxx() method of the node will be called.

#### Visitor
Antlr4 generates a listener by default, and specifies the generation of a visitor by adding the -visitor parameter.
```
antlr4 -Dlanguage=Python3 -visitor Example.g4
```

## 2. error_manager module
Antlr4 can check and report lexical and syntax errors in the input file, and by default sends error messages to standard error. To facilitate locating and resolving errors, the project customizes error messages.
- Error monitoring: The content and output target of the message can be changed by implementing the ErrorListener interface. The project implements the ErrorListener interface and builds its own error listener to standardize error messages.
- Output error messages: Use Python's logging module to output error messages.

To make the custom error handling module effective, it is necessary to remove the default error listener and add the custom error listener before parsing the input file.

```
lexer/parser.removeErrorListener()
lexer/parser.addErrorListener(OscErrorListener)
```

## III. ast_manager module
The ast_manager module is used to create abstract syntax trees, including defining ast nodes and building asts.
- Definition of ast nodes: The Node class is the base class for all ast nodes, defining 1) the position information of the corresponding source code; 2) the scope of the node; and 3) child nodes. All other nodes inherit directly or indirectly from this node.
- Building asts: The ast is constructed by traversing the syntax parse tree generated by Antlr4. The listener is used to traverse the syntax parse tree, create ast nodes in the callback function, and add nodes to the abstract syntax tree.

## IV. symbol_manager module
The symbol management module is used to record the definition of symbols and track their usage, ensuring that symbols are defined before they are used and used within their scope.
- Symbol class definition: The Symbol class is the base class for all symbols, defining basic information about symbols such as name and category. Other symbol classes extend the Symbol class.
- Scope: By traversing the syntax parsing tree, the symbol scope is created as a tree structure, on which the inheritance and extension features of OpenScenario 2.0 are implemented.